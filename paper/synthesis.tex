A \emph{system} is a collection of \emph{components}, \emph{connections} between components, a \emph{scheduler} to order execution, and a \emph{system environment} for primary inputs. The computation for the component in this work is defined entirely by a step function:
\[
\konst{stepFn} : \mathit{input} \times \mathit{stateVars} \to \mathit{stateVars} \times \mathit{output}
\]
The scheduler \emph{activates} components in some order. Activating a component is defined as follows: 
\[
\begin{array}{ll}
 \mathit{(i_1,\ldots)} & = \konst{readInputs}(); \\
 (v_1,\ldots) & = \konst{readState}() ; \\
 ({v_1}',\ldots), ({o_1}',\ldots) & = \konst{stepFn} ((i_1,\ldots),(v_1,\ldots)) ; \\
 \multicolumn{2}{l}{\konst{writeState}({v_1}',\ldots);} \\
 \multicolumn{2}{l}{\konst{writeOutputs}({o_1}'\ldots);} \\
\end{array}
\]
It is assumed that the scheduler follows some sensible partial order of component activation and allows each component sufficient time for its computation.

\newsavebox{\cml}
\begin{lrbox}{\cml}
\begin{lstlisting}[style=myML]
fun filter_step () =
let val () = Utils.clear_buf buffer
    val () = API.callFFI "get_input" "" buffer
    val string = Utils.buf2string buffer
    val policy = WELL_FORMED_AUTOMATION_RESPONSE string 
in
    if policy
    then
        let val string = Word8Array.substring buffer 1
                          (Word8Array.length buffer - 1)
        in API.callFFI "put_output" string Utils.emptybuf
        end
    else print"Filter rejects message.\n"
end
\end{lstlisting}
\end{lrbox}

\begin{figure}
  \begin{center}
    \begin{tabular}{c}
      \scalebox{0.60}{\usebox{\cml}}
    \end{tabular}
  \end{center}
  \caption{Synthesized CakeML for the filter.}
  \label{fig:cakeml}
\end{figure}

The synthesized CakeML code for the filter is shown in \figref{fig:cakeml}. The code is called at dispatch by the scheduler. The \texttt{API.callFFI} is the link to the communication fabric to capture input and provide output. The body of the function restates the filter contract to make the appropriate assignments in a way that matches the truth value of the predicate in the filter guarantee.
The auto-generated AGREE specification raises an alert output when the relation is violated. 
