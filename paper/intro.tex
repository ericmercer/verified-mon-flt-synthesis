
%% \egm{Add to introduction and related work, that what is done at
%% Galois called Copilot. Its a stream processing langague that generates
%% code from the specification. Copilot to C. Effectively CodeGen from
%% Lustre. Bounds how far needed to look in past for any value.}

In recent years, aerospace stakeholders have realized that avionics
systems are subject to possible cyber-attacks just like other
cyber-physical systems.
%
\footnote{This work was funded in part by the
Defense Advanced Research Projects Agency (DARPA) CASE program.  The views
expressed are those of the authors and do not reflect the official
policy or position of DARPA or the U.S. Government.}
%
Thus, in addition to being fault-tolerant, safety-critical avionics
systems must also be {\em cyber-resilient}.  Cyber-resiliency means
that the system is tolerant to cyber-attacks just as safety-critical
systems are tolerant to random faults: they recover and continue to
execute their mission function, or safely shut down, as requirements
dictate.

Unfortunately, systems engineers are currently given few development
tools to help answer even basic questions about potential
vulnerabilities and ways to mitigate vulnerabilities.  They instead
rely on process-oriented checklists and guidelines.  Cyber
vulnerabilities are often discovered during penetration testing late
in the development process; or worse yet, they may be discovered only
after the product has been fielded, necessitating extremely expensive
and time-consuming remediation. This is not a sustainable development
model.

%% The DARPA Cyber Assured Systems Engineering (CASE) project is targeted
%% at developing tools for design, analysis, and verification that enable
%% systems engineers to {\em design-in} cyber-resiliency for complex
%% cyber-physical systems.

We have been developing the {\em BriefCASE} toolsuite to address this need.
\brfcs\ is a Model-Based Systems Engineering (MBSE) environment
built in the Open Source AADL\footnote{AADL is the acronym for
Architecture Analysis and Design Language~\cite{aadl}.}  Tool
Environment (OSATE) to add new capabilities for building
cyber-resilient systems.

In this paper we describe how \brfcs\ facilitates specifying, testing,
verifying, and synthesizing high assurance components inserted into a
system to improve its cyber-resiliency.  The main organizing concept
is that of an architecture-to-architecture \emph{security-improving
transform}, achieved via the insertion of a new architectural
component aimed at mitigating a cyber-vulnerability.  We describe two
such transformations in this paper: (1) the insertion of a
filter to prevent malformed data from a malicious actor being
propagated to downstream components, and (2) the insertion of a
runtime monitor to detect (and alert) unexpected behaviors arising
from untrusted components.

{\agr}
\footnote{AGREE is the acronym for \emph{Assume Guarantee Reasoning Environment} \cite{agree2013}.}
provides the formal setting for our work.
{\agr} is implemented in OSATE as an \emph{annex}; hence AGREE
specifications inherit AADL constructs for describing system
structure, interconnections, and data. {\agr} uses \emph{contracts}
expressed in a variant of Past-Time Linear Temporal Logic to formally
specify input and output properties of components and systems. In this
paper we introduce the notion of a \emph{code contract}: a class of
contracts that support the synthesis of implementations. The code
contract language is Turing complete, allowing the designer to specify
arbitrarily complex behavior.  These contracts are unit tested for
correctness with \emph{test contracts}.  Test contracts define test
scenarios to be implemented by the code contract under test.  {\agr}
proves whether or not that code contract implementation is correct,
enabling the designer to iteratively test the component behavior
inside the \brfcs\ environment.  Once the behavior of the code
contract is verified, \agr\ proves that---due to the newly included
high-assurance components---the hardened system meets its
cyber-resiliency requirements.

A novel aspect of our work is the synthesis of {\ckml} code from the
code contracts for high-assurance components. {\ckml} is a dialect of
the ML programming language possessing a verified
compiler \cite{cakeml}.  We give a detailed outline of the synthesis
path from code contracts to \ckml\ code, providing a formal framework
in which to argue correctness. \ckml\ then provides a verified
compilation path to several different target binaries (and also
proving that the meaning of the \ckml\ source code is exactly
preserved in the final binaries).  A key contribution here is that the
code contract semantics are defined in such a way that the \agr\
verification results for the code contract hold for the deployed
component, \ie, the component will detect and prevent the indicated
cyber-vulnerabilities over all possible finite inputs. Preliminary
work has shown how to extend our work to handle infinite input traces
as these systems are inherently reactive and intended to run
forever~\cite{case-verified-filter}, \cite{cakeml-space-cost}.

We report on a case study applying these transformations with \brfcs\
to an Unmanned Aerial Vehicle (UAV) system that uses the Air Force
Research Laboratory's OpenUxAS services for route planning.  OpenUxAS,
as an open source product, is considered \emph{untrusted}.  The UAV
system is thus transformed to be resilient to malicious behavior that
may arise in the untrusted component.  In particular, filters are
added to guard against malformed input and a monitor is created to
guard against malicious flight plans generated from OpenUxAS. The case
study system is complex and shows the viability of the approach in
potential full-scale industrial design.

{\brfcs} is open source and publicly available \cite{fmide}, as are the
examples and case study we discussed in this paper \cite{repo,
phase2, camkes, case}.

\subsubsection*{Contributions and limitations}

As indicated in the preceding discussion, {\brfcs} is aimed at
addressing the lack of tool support for the the problem of enforcing
and implementing the class of \emph{cyber-resilience} system
requirements.  Our approach to the problem is embedded in a
substantial collection of tools, so it is important to clarify the
research impact. We see the following as the distinguishing
contributions of this paper:

\begin{compactitem}
  \item The language and semantics of \emph{code contracts} provide a
  means to join system-level contract analysis results (arising from
  model checking) with component implementation correctness results
  (arising from property-preserving code generation).

\item We provide a strong formal path connecting (A) top-level system cyber-resilience
  requirements, (B) specifications for high-assurance components
  inserted to mitigate against specific cyber-resilience problems, and
  (C) synthesis to a programming language with a verified compiler.

\item \emph{Test contracts} as a
  stylized mechanism to unit test code contracts inside the \brfcs\
  framework with \agr.

\item A case study that demonstrates the use of \brfcs\ to add cyber-resiliency
 to a non-trivial UAV system.
\end{compactitem}

Our approach currently applies to common cyber-vulnerabilities, such
as buffer overflow, lack of input validation, and supply-chain issues;
however, other cyber-vulnerabilities such as side-channel attacks and
denial of service have not yet been addressed. Moreover, this work
does not introduce a new type of high-assurance component in terms of
capability. Instead, our contribution is in the automated synthesis of
security-improving components from formal cyber-resilience
specifications, paired with a verification showing that the
synthesized implementation is correct. We have not yet tried to apply
{\brfcs} to problems outside the realm of cyber-resilience; however,
the notions of code and test contracts, along with the system analysis
and verified code generation facilities promise to be useful in a wide
variety of settings.

\subsubsection*{Organization}
The rest of the paper is organized as follows.
\secref{sec:overview} is an overview of the {\brfcs} environment.
Our approach is illustrated by a simple example in
\secref{sec:example}. Essential background on {\agr} verification and specification are
presented in \secref{sec:agree}.  The language and semantics of code
contracts are defined in \secref{sec:code-contracts}, and test
contracts are described in \secref{sec:testing}.  The synthesis pathway
is covered in Section~\ref{sec:synthesis}.
\secref{sec:case-study} discusses the case study.
This is followed by related work in \secref{sec:related-work}.
The conclusions and future work are in \secref{sec:conclusion}.

\begin{comment}
  BriefCASE incorporates model-level cyber analysis tools (presently
  GearCASE~\cite{gearcase2020} and DCRYPPS~\cite{dcrypps2019}) which can
  examine AADL models for potential vulnerabilities and suggest
  cyber-security requirements to mitigate them.  A library of
  architectural transforms guides the system engineer through automated
  model transformations that modify the architecture to address these
  requirements, possibly inserting new high-assurance components into
  the system.  Implementations for the new components are synthesized
  from formal specifications using
  SPLAT~\cite{slind-hcss2020},~\cite{formal-filter-synth-langsec}
  (Semantic Properties for Language and Automata Theory).


  Formal
  verification that the transformed system model meets its requirements
  is accomplished via \agr~\cite{agree2013} (Assume Guarantee Reasoning
  Environment).
  %The AGREE analysis \emph{assumes} properties on the inputs of a given component of the system, and attempts to formally prove the conjectured \emph{guarantees} of the output.
  \agr\ is a {\em compositional assume-guarantee} style model checker
  for AADL models that attempts to prove properties about one layer of
  an architecture using properties allocated to its subcomponents.
  Cyber-resilient code implementing the verified model is then
  automatically generated using the High Assurance Modeling and Rapid
  Engineering for Embedded Systems (HAMR) toolkit~\cite{hamr}.  If
  desired, this code can be targeted to the formally verified seL4
  secure microkernel~\cite{sel4-2009}.
\end{comment}
